<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Triple Timer Overlay</title>

<style>
  body {
    margin: 0;
    background: #000;
    height: 100vh;
    font-family: Impact, Arial, sans-serif;
    color: #fff;
    overflow: hidden;
  }

  .timer {
    position: fixed;
    font-size: 100px;
    text-shadow: 0 0 15px rgba(255,0,0,0.8);
    width: 100%;
    text-align: center;
    left: 50%;
    transform: translateX(-50%);
  }

  #timeA { top: 20%; }
  #timeB { top: 50%; transform: translate(-50%, -50%); }
  #timeC { top: 80%; }
</style>
</head>
<body>

  <div id="timeA" class="timer">00:00:00</div>
  <div id="timeB" class="timer">00:00:00</div>
  <div id="timeC" class="timer">00:00:00</div>

<script>
  // ===== TIMER STATE =====
  let timers = {
    A: { end:null, running:false, pausedRemaining:0 },
    B: { end:null, running:false, pausedRemaining:0 },
    C: { end:null, running:false, pausedRemaining:0 }
  };

  // Load saved timers from localStorage
  const saved = localStorage.getItem("timers");
  if(saved){
    const parsed = JSON.parse(saved);
    for(const id of ["A","B","C"]){
      if(parsed[id]){
        timers[id] = parsed[id];
        // Adjust end time if still running
        if(timers[id].running && timers[id].end){
          timers[id].end = Date.now() + timers[id].pausedRemaining;
        }
      }
    }
  }

  function fmt(ms){
    if(ms<=0) return "00:00:00";
    let s=Math.floor(ms/1000);
    let h=Math.floor(s/3600);
    let m=Math.floor((s%3600)/60);
    s=s%60;
    return [h,m,s].map(n=>String(n).padStart(2,'0')).join(":");
  }

  function tick(){
    const now = Date.now();
    for(const id of ["A","B","C"]){
      const t = timers[id];
      const el = document.getElementById("time"+id);

      if(t.running && t.end){
        let rem = t.end - now;
        if(rem <= 0){
          rem = 0;
          t.running = false;
        }
        el.textContent = fmt(rem);
        t.pausedRemaining = rem; // save remaining for pause/resume
      }
    }
    setTimeout(tick, 200);
  }
  tick();

  function startTimer(id, seconds=0){
    const t = timers[id];
    if(!t.running){
      if(seconds > 0){
        t.end = Date.now() + seconds * 1000;
      } else if(t.pausedRemaining && t.pausedRemaining > 0){
        t.end = Date.now() + t.pausedRemaining;
      } else if(!t.end){
        t.end = Date.now();
      }
      t.running = true;
      saveTimers();
    }
  }

  function stopTimer(id){
    const t = timers[id];
    t.running = false;
    t.end = null;
    t.pausedRemaining = 0;
    document.getElementById("time"+id).textContent = "00:00:00";
    saveTimers();
  }

  function addTime(id, sec){
    const t = timers[id];
    if(!t.end) t.end = Date.now();
    t.end += sec * 1000;
    t.running = true;
    saveTimers();
  }

  // NUMPAD CONTROLS
  document.addEventListener("keydown",(e)=>{
    switch(e.code){
      case "Numpad7": startTimer("A"); break;
      case "Numpad8": stopTimer("A"); break;
      case "Numpad9": addTime("A", 1800); break;

      case "Numpad4": startTimer("B"); break;
      case "Numpad5": stopTimer("B"); break;
      case "Numpad6": addTime("B", 1800); break;

      case "Numpad1": startTimer("C"); break;
      case "Numpad2": stopTimer("C"); break;
      case "Numpad3": addTime("C", 1800); break;
    }
  });

  // SAVE TO LOCALSTORAGE
  function saveTimers(){
    localStorage.setItem("timers", JSON.stringify(timers));
  }

  // Auto-pause when tab hidden, auto-resume when visible
  document.addEventListener("visibilitychange", ()=>{
    for(const id of ["A","B","C"]){
      const t = timers[id];
      if(document.hidden && t.running){
        // pause
        t.pausedRemaining = t.end - Date.now();
        t.running = false;
        saveTimers();
      } else if(!document.hidden && t.pausedRemaining > 0){
        // resume
        t.end = Date.now() + t.pausedRemaining;
        t.running = true;
        saveTimers();
      }
    }
  });

  // ===== TikFinity socket (optional) =====
  /*
  const socket = new WebSocket("ws://localhost:8080");
  socket.onopen = () => console.log("Connected to TikFinity");
  socket.onmessage = (event) => {
    const data = JSON.parse(event.data);
    if(data.type === "gift"){
      if(data.name === "Birthday Cake") addTime("A", 1800);
      if(data.name === "Galaxy") addTime("A", 14400);

      if(data.name === "TikTok Crown") addTime("B", 1800);
      if(data.name === "Umbrella of Love") addTime("B", 14400);
    }
  };
  */
</script>

</body>
</html>
